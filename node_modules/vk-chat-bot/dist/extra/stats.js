"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const chalk_1=__importDefault(require("chalk")),moment_1=__importDefault(require("moment")),log_1=require("./log");require("moment-duration-format")(moment_1.default);class Stats{constructor(){this.rx=0,this.tx=0,this.eventCounters={message_new:0,message_reply:0,message_edit:0,message_typing_state:0,message_allow:0,message_deny:0,start:0,service_action:0,no_match:0,handler_error:0},this.previous="",log_1.log().i("Stats initialized").from("stat").now(),setInterval(()=>{this.print()},1e4)}sent(){this.tx+=1}event(t){this.rx+=1,this.eventCounters[t]+=1;["start","service_action","no_match","handler_error"].includes(t)&&(this.rx-=1)}getEventCount(t){return this.eventCounters[t].toString()}print(){const t=chalk_1.default.underline.green(this.rx.toString()),e=chalk_1.default.underline.cyan(this.tx.toString()),n=chalk_1.default.green(this.getEventCount("message_new")),s=chalk_1.default.green(this.getEventCount("message_allow")),a=chalk_1.default.red(this.getEventCount("message_deny")),r=chalk_1.default.green(this.getEventCount("message_edit")),o=chalk_1.default.cyan(this.getEventCount("message_reply")),i=chalk_1.default.green(this.getEventCount("message_typing_state")),l=chalk_1.default.green(this.getEventCount("start")),u=chalk_1.default.green(this.getEventCount("service_action")),_=chalk_1.default.bold.magenta(this.getEventCount("no_match")),h=chalk_1.default.bold.magenta(this.getEventCount("handler_error")),g=moment_1.default.duration(process.uptime(),"seconds").format("y[y] d[d] h[h] m[m] s[s]");let d=`rx:${t} tx:${e} | allow/deny:${s}/${a} typing:${i} new:${n}(start:${l} action:${u}) edit:${r} | reply:${o} | no_match:${_} err:${h}`;d!==this.previous&&(this.previous=d,d=`[${g}] ${d}`,log_1.log().i(d).from("stat").now())}}exports.default=Stats;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dHJhL3N0YXRzLmpzIiwiZXh0cmEvc3RhdHMudHMiXSwibmFtZXMiOlsiX19pbXBvcnREZWZhdWx0IiwidGhpcyIsIm1vZCIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJjaGFsa18xIiwicmVxdWlyZSIsIm1vbWVudF8xIiwibG9nXzEiLCJTdGF0cyIsIltvYmplY3QgT2JqZWN0XSIsInJ4IiwidHgiLCJldmVudENvdW50ZXJzIiwibWVzc2FnZV9uZXciLCJtZXNzYWdlX3JlcGx5IiwibWVzc2FnZV9lZGl0IiwibWVzc2FnZV90eXBpbmdfc3RhdGUiLCJtZXNzYWdlX2FsbG93IiwibWVzc2FnZV9kZW55Iiwic3RhcnQiLCJzZXJ2aWNlX2FjdGlvbiIsIm5vX21hdGNoIiwiaGFuZGxlcl9lcnJvciIsInByZXZpb3VzIiwibG9nIiwiaSIsImZyb20iLCJub3ciLCJzZXRJbnRlcnZhbCIsInByaW50IiwiZXZlbnROYW1lIiwiaW5jbHVkZXMiLCJ0b1N0cmluZyIsInVuZGVybGluZSIsImdyZWVuIiwiY3lhbiIsIm1uIiwiZ2V0RXZlbnRDb3VudCIsIm1hIiwibWQiLCJyZWQiLCJtZSIsIm1yIiwibXRzIiwic3QiLCJzYSIsIm5tIiwiYm9sZCIsIm1hZ2VudGEiLCJoZSIsInVwIiwiZHVyYXRpb24iLCJwcm9jZXNzIiwidXB0aW1lIiwiZm9ybWF0IiwibWVzc2FnZSJdLCJtYXBwaW5ncyI6IkFBQUEsYUFDQSxJQUFJQSxnQkFBbUJDLE1BQVFBLEtBQUtELGlCQUFvQixTQUFVRSxHQUM5RCxPQUFRQSxHQUFPQSxFQUFJQyxXQUFjRCxFQUFNLENBQUVFLFFBQVdGLElBRXhERyxPQUFPQyxlQUFlQyxRQUFTLGFBQWMsQ0FBRUMsT0FBTyxJQ0p0RCxNQUFBQyxRQUFBVCxnQkFBQVUsUUFBQSxVQUNBQyxTQUFBWCxnQkFBQVUsUUFBQSxXQUNBRSxNQUFBRixRQUFBLFNBRUFBLFFBQVEseUJBQVJBLENBQWtDQyxTQUFBUCxTQXNDbEMsTUFBcUJTLE1BdUNqQkMsY0FuQ09iLEtBQUFjLEdBQWEsRUFLYmQsS0FBQWUsR0FBYSxFQU1iZixLQUFBZ0IsY0FBMkMsQ0FDOUNDLFlBQWEsRUFDYkMsY0FBZSxFQUNmQyxhQUFjLEVBQ2RDLHFCQUFzQixFQUN0QkMsY0FBZSxFQUNmQyxhQUFjLEVBRWRDLE1BQU8sRUFDUEMsZUFBZ0IsRUFFaEJDLFNBQVUsRUFDVkMsY0FBZSxHQU9aMUIsS0FBQTJCLFNBQW1CLEdBTXRCaEIsTUFBQWlCLE1BQ0tDLEVBQUUscUJBQ0ZDLEtBQUssUUFDTEMsTUFFTEMsWUFBWSxLQUNSaEMsS0FBS2lDLFNBQ04sS0FNQXBCLE9BQ0hiLEtBQUtlLElBQU0sRUFNUkYsTUFBTXFCLEdBQ1RsQyxLQUFLYyxJQUFNLEVBQ1hkLEtBQUtnQixjQUFja0IsSUFBYyxFQUVWLENBQ25CLFFBQ0EsaUJBQ0EsV0FDQSxpQkFFZUMsU0FBU0QsS0FDeEJsQyxLQUFLYyxJQUFNLEdBT1hELGNBQWNxQixHQUNsQixPQUFPbEMsS0FBS2dCLGNBQWNrQixHQUFXRSxXQU1qQ3ZCLFFBQ0osTUFBTUMsRUFBS04sUUFBQUwsUUFBTWtDLFVBQVVDLE1BQU10QyxLQUFLYyxHQUFHc0IsWUFDbkNyQixFQUFLUCxRQUFBTCxRQUFNa0MsVUFBVUUsS0FBS3ZDLEtBQUtlLEdBQUdxQixZQUVsQ0ksRUFBS2hDLFFBQUFMLFFBQU1tQyxNQUFNdEMsS0FBS3lDLGNBQWMsZ0JBQ3BDQyxFQUFLbEMsUUFBQUwsUUFBTW1DLE1BQU10QyxLQUFLeUMsY0FBYyxrQkFDcENFLEVBQUtuQyxRQUFBTCxRQUFNeUMsSUFBSTVDLEtBQUt5QyxjQUFjLGlCQUNsQ0ksRUFBS3JDLFFBQUFMLFFBQU1tQyxNQUFNdEMsS0FBS3lDLGNBQWMsaUJBQ3BDSyxFQUFLdEMsUUFBQUwsUUFBTW9DLEtBQUt2QyxLQUFLeUMsY0FBYyxrQkFDbkNNLEVBQU12QyxRQUFBTCxRQUFNbUMsTUFBTXRDLEtBQUt5QyxjQUFjLHlCQUVyQ08sRUFBS3hDLFFBQUFMLFFBQU1tQyxNQUFNdEMsS0FBS3lDLGNBQWMsVUFDcENRLEVBQUt6QyxRQUFBTCxRQUFNbUMsTUFBTXRDLEtBQUt5QyxjQUFjLG1CQUVwQ1MsRUFBSzFDLFFBQUFMLFFBQU1nRCxLQUFLQyxRQUFRcEQsS0FBS3lDLGNBQWMsYUFDM0NZLEVBQUs3QyxRQUFBTCxRQUFNZ0QsS0FBS0MsUUFBUXBELEtBQUt5QyxjQUFjLGtCQUUzQ2EsRUFBSzVDLFNBQUFQLFFBQ05vRCxTQUFTQyxRQUFRQyxTQUFVLFdBQzNCQyxPQUFPLDRCQUVaLElBQUlDLFFBQWdCN0MsUUFBU0Msa0JBQW1CMkIsS0FBTUMsWUFBYUksU0FBV1AsV0FBWVEsWUFBYUMsV0FBWUosYUFBY0MsZ0JBQWlCSSxTQUFVRyxJQUV4Sk0sSUFBWTNELEtBQUsyQixXQUdyQjNCLEtBQUsyQixTQUFXZ0MsRUFFaEJBLE1BQWNMLE1BQU9LLElBRXJCaEQsTUFBQWlCLE1BQ0tDLEVBQUU4QixHQUNGN0IsS0FBSyxRQUNMQyxRQXRIYnpCLFFBQUFILFFBQUFTIiwiZmlsZSI6ImV4dHJhL3N0YXRzLmpzIiwic291cmNlc0NvbnRlbnQiOltudWxsLCJpbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgbG9nIH0gZnJvbSAnLi9sb2cnO1xuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby12YXItcmVxdWlyZXNcbnJlcXVpcmUoJ21vbWVudC1kdXJhdGlvbi1mb3JtYXQnKShtb21lbnQpO1xuXG4vKipcbiAqIFN0YXRzIHN0b3JlcyBhbmQgcHJpbnRzIHN0YXRpc3RpY3MuXG4gKlxuICogVGhlIGJvdCBsb2dzIHN0YXRpc3RpY3MgZWFjaCAqKn4xMHMqKiAoaWYgdGhleSBjaGFuZ2VkKTpcbiAqXG4gKiAgYGBgY29uc29sZVxuICogICBzdGF0IGluZm8gWzEyeSAzNGQgMTJoIDM0bSA1NnNdIHJ4OjMyIHR4OjE2IHwgYWxsb3cvZGVueTo1LzAgdHlwaW5nOjMgbmV3Ojcoc3RhcnQ6MiBhY3Rpb246MSkgZWRpdDoxIHwgcmVwbHk6MTYgfCBub19tYXRjaDowIGVycjowXG4gKiAgYGBgXG4gKlxuICogIyMjIEdlbmVyYWwgc3RhdGlzdGljc1xuICpcbiAqIFN0YXRpc3RpY3MgfCBEZXNjcmlwdGlvblxuICogLS0tIHwgLS0tXG4gKiBgWy4uLl1gIHwgUHJvY2VzcyB1cHRpbWVcbiAqIGByeGAgfCBBbW91bnQgb2YgcmVjZWl2ZWQgZXZlbnRzIGZyb20gQ2FsbGJhY2sgQVBJXG4gKiBgdHhgIHwgQW1vdW50IG9mIHNlbnQgbWVzc2FnZXNcbiAqXG4gKiAjIyMgQ2FsbGJhY2sgQVBJIGV2ZW50IHN0YXRpc3RpY3NcbiAqIFN0YXRpc3RpY3MgfCBEZXNjcmlwdGlvblxuICogLS0tIHwgLS0tXG4gKiBgbmV3YCB8IGBtZXNzYWdlX25ld2AgZXZlbnRzXG4gKiBgYWxsb3dgIHwgYG1lc3NhZ2VfYWxsb3dgIGV2ZW50c1xuICogYGRlbnlgIHwgYG1lc3NhZ2VfZGVueWAgZXZlbnRzXG4gKiBgZWRpdGAgfCBgbWVzc2FnZV9lZGl0YCBldmVudHNcbiAqIGByZXBseWAgfCBgbWVzc2FnZV9yZXBseWAgZXZlbnRzXG4gKiBgdHlwaW5nYCB8IGBtZXNzYWdlX3R5cGluZ19zdGF0ZWAgZXZlbnRzXG4gKlxuICogIyMjIE90aGVyIGV2ZW50IHN0YXRpc3RpY3NcbiAqIFN0YXRpc3RpY3MgfCBEZXNjcmlwdGlvblxuICogLS0tIHwgLS0tXG4gKiBgc3RhcnRgIHwgYHN0YXJ0YCBldmVudHNcbiAqIGBhY3Rpb25gIHwgYHNlcnZpY2VfYWN0aW9uYCBldmVudHNcbiAqIGBub19tYXRjaGAgfCBgbm9fbWF0Y2hgIGV2ZW50c1xuICogYGVycmAgfCBgaGFuZGxlcl9lcnJvcmAgZXZlbnRzXG4gKlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdGF0cyB7XG4gICAgLyoqXG4gICAgICogQ291bnQgb2YgcmVxdWVzdHMgZnJvbSB0aGUgQ2FsbGJhY2sgQVBJLlxuICAgICAqL1xuICAgIHB1YmxpYyByeDogbnVtYmVyID0gMDtcblxuICAgIC8qKlxuICAgICAqIENvdW50IG9mIG1lc3NhZ2VzIHNlbnQuXG4gICAgICovXG4gICAgcHVibGljIHR4OiBudW1iZXIgPSAwO1xuXG4gICAgLyoqXG4gICAgICogQ291bnQgb2YgdmFyaW91cyBldmVudHMuXG4gICAgICovXG4gICAgLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L2NhbWVsY2FzZSAqL1xuICAgIHB1YmxpYyBldmVudENvdW50ZXJzOiB7IFtrZXk6IHN0cmluZ106IG51bWJlciB9ID0ge1xuICAgICAgICBtZXNzYWdlX25ldzogMCxcbiAgICAgICAgbWVzc2FnZV9yZXBseTogMCxcbiAgICAgICAgbWVzc2FnZV9lZGl0OiAwLFxuICAgICAgICBtZXNzYWdlX3R5cGluZ19zdGF0ZTogMCxcbiAgICAgICAgbWVzc2FnZV9hbGxvdzogMCxcbiAgICAgICAgbWVzc2FnZV9kZW55OiAwLFxuXG4gICAgICAgIHN0YXJ0OiAwLFxuICAgICAgICBzZXJ2aWNlX2FjdGlvbjogMCxcblxuICAgICAgICBub19tYXRjaDogMCxcbiAgICAgICAgaGFuZGxlcl9lcnJvcjogMCxcbiAgICB9O1xuICAgIC8qIGVzbGludC1lbmFibGUgQHR5cGVzY3JpcHQtZXNsaW50L2NhbWVsY2FzZSAqL1xuXG4gICAgLyoqXG4gICAgICogUHJldmlvdXMgc3RhdHMgbG9nIG1lc3NhZ2UsIHdpdGhvdXQgdGltZVxuICAgICAqL1xuICAgIHB1YmxpYyBwcmV2aW91czogc3RyaW5nID0gJyc7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IFtbU3RhdHNdXS5cbiAgICAgKi9cbiAgICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGxvZygpXG4gICAgICAgICAgICAuaSgnU3RhdHMgaW5pdGlhbGl6ZWQnKVxuICAgICAgICAgICAgLmZyb20oJ3N0YXQnKVxuICAgICAgICAgICAgLm5vdygpO1xuXG4gICAgICAgIHNldEludGVydmFsKCgpOiB2b2lkID0+IHtcbiAgICAgICAgICAgIHRoaXMucHJpbnQoKTtcbiAgICAgICAgfSwgMTAwMDApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgaXMgdXNlZCB0byB0ZWxsIGBTdGF0c2AgdGhhdCBhIG1lc3NhZ2Ugd2FzIHNlbnQuXG4gICAgICovXG4gICAgcHVibGljIHNlbnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMudHggKz0gMTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIGlzIHVzZWQgdG8gdGVsbCBgU3RhdHNgIHRoYXQgYW4gZXZlbnQgd2FzIGVtaXR0ZWQuXG4gICAgICovXG4gICAgcHVibGljIGV2ZW50KGV2ZW50TmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMucnggKz0gMTtcbiAgICAgICAgdGhpcy5ldmVudENvdW50ZXJzW2V2ZW50TmFtZV0gKz0gMTtcblxuICAgICAgICBjb25zdCBpbnRlcm5hbEV2ZW50cyA9IFtcbiAgICAgICAgICAgICdzdGFydCcsXG4gICAgICAgICAgICAnc2VydmljZV9hY3Rpb24nLFxuICAgICAgICAgICAgJ25vX21hdGNoJyxcbiAgICAgICAgICAgICdoYW5kbGVyX2Vycm9yJyxcbiAgICAgICAgXTtcbiAgICAgICAgaWYgKGludGVybmFsRXZlbnRzLmluY2x1ZGVzKGV2ZW50TmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMucnggLT0gMTsgLy8gTm90IGZyb20gQ2FsbGJhY2sgQVBJXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGhvdyBtdWNoIGV2ZW50cyBvZiB0aGlzIHR5cGUgd2VyZSBlbWl0dGVkLlxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0RXZlbnRDb3VudChldmVudE5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmV2ZW50Q291bnRlcnNbZXZlbnROYW1lXS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByaW50cyB0aGUgc3RhdGlzdGljcyBpZiB0aGV5IGNoYW5nZWQuXG4gICAgICovXG4gICAgcHJpdmF0ZSBwcmludCgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcnggPSBjaGFsay51bmRlcmxpbmUuZ3JlZW4odGhpcy5yeC50b1N0cmluZygpKTtcbiAgICAgICAgY29uc3QgdHggPSBjaGFsay51bmRlcmxpbmUuY3lhbih0aGlzLnR4LnRvU3RyaW5nKCkpO1xuXG4gICAgICAgIGNvbnN0IG1uID0gY2hhbGsuZ3JlZW4odGhpcy5nZXRFdmVudENvdW50KCdtZXNzYWdlX25ldycpKTtcbiAgICAgICAgY29uc3QgbWEgPSBjaGFsay5ncmVlbih0aGlzLmdldEV2ZW50Q291bnQoJ21lc3NhZ2VfYWxsb3cnKSk7XG4gICAgICAgIGNvbnN0IG1kID0gY2hhbGsucmVkKHRoaXMuZ2V0RXZlbnRDb3VudCgnbWVzc2FnZV9kZW55JykpO1xuICAgICAgICBjb25zdCBtZSA9IGNoYWxrLmdyZWVuKHRoaXMuZ2V0RXZlbnRDb3VudCgnbWVzc2FnZV9lZGl0JykpO1xuICAgICAgICBjb25zdCBtciA9IGNoYWxrLmN5YW4odGhpcy5nZXRFdmVudENvdW50KCdtZXNzYWdlX3JlcGx5JykpO1xuICAgICAgICBjb25zdCBtdHMgPSBjaGFsay5ncmVlbih0aGlzLmdldEV2ZW50Q291bnQoJ21lc3NhZ2VfdHlwaW5nX3N0YXRlJykpO1xuXG4gICAgICAgIGNvbnN0IHN0ID0gY2hhbGsuZ3JlZW4odGhpcy5nZXRFdmVudENvdW50KCdzdGFydCcpKTtcbiAgICAgICAgY29uc3Qgc2EgPSBjaGFsay5ncmVlbih0aGlzLmdldEV2ZW50Q291bnQoJ3NlcnZpY2VfYWN0aW9uJykpO1xuXG4gICAgICAgIGNvbnN0IG5tID0gY2hhbGsuYm9sZC5tYWdlbnRhKHRoaXMuZ2V0RXZlbnRDb3VudCgnbm9fbWF0Y2gnKSk7XG4gICAgICAgIGNvbnN0IGhlID0gY2hhbGsuYm9sZC5tYWdlbnRhKHRoaXMuZ2V0RXZlbnRDb3VudCgnaGFuZGxlcl9lcnJvcicpKTtcblxuICAgICAgICBjb25zdCB1cCA9IG1vbWVudFxuICAgICAgICAgICAgLmR1cmF0aW9uKHByb2Nlc3MudXB0aW1lKCksICdzZWNvbmRzJylcbiAgICAgICAgICAgIC5mb3JtYXQoJ3lbeV0gZFtkXSBoW2hdIG1bbV0gc1tzXScpO1xuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxuICAgICAgICBsZXQgbWVzc2FnZSA9IGByeDoke3J4fSB0eDoke3R4fSB8IGFsbG93L2Rlbnk6JHttYX0vJHttZH0gdHlwaW5nOiR7bXRzfSBuZXc6JHttbn0oc3RhcnQ6JHtzdH0gYWN0aW9uOiR7c2F9KSBlZGl0OiR7bWV9IHwgcmVwbHk6JHttcn0gfCBub19tYXRjaDoke25tfSBlcnI6JHtoZX1gO1xuXG4gICAgICAgIGlmIChtZXNzYWdlID09PSB0aGlzLnByZXZpb3VzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcmV2aW91cyA9IG1lc3NhZ2U7XG5cbiAgICAgICAgbWVzc2FnZSA9IGBbJHt1cH1dICR7bWVzc2FnZX1gO1xuXG4gICAgICAgIGxvZygpXG4gICAgICAgICAgICAuaShtZXNzYWdlKVxuICAgICAgICAgICAgLmZyb20oJ3N0YXQnKVxuICAgICAgICAgICAgLm5vdygpO1xuICAgIH1cbn1cbiJdfQ==
